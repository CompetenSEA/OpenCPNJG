# CM93/S-57 → Web (S-52 Day) Pipeline

**Design goals:** upstream S-52 assets as-is; vector-first; optional raster; no binaries in PRs; `sc` end-to-end.

## 1. Assets (lock-based)
- Lock format, required files, manifest, reproducibility, local-src mode.

## 2. Sprite & Style (Day)
- Sprite: atlas PNG served as-is; JSON generated; **prefix** support.
- Style: Tier-1 layers; QUAPOS; safety overlay; SOUNDG day tokens; hazard layer (prefix-safe).

## 3. Palettes
- `build_style_json.py --palette day|dusk|night` selects colour tables.
- Palette tokens (e.g. `SNDG1/2`) thread through style generation and tests.

## 4. Pre-classification (server-side CSP proxies)
- DEPARE → `isShallow`, `depthBand`; DEPCNT → `role`; SOUNDG → `isShallow`.
- UDW hazards → `hazardIcon` (+ now `hazardOffX/hazardOffY`).

## 5. Tile server
- Endpoints, cache key (`fmt:safety,shallow,deep:z/x/y`), headers, metrics.

## 6. ContourConfig
- Schema: `{safety, shallow, deep, hazardBuffer?}`; defaults `10/5/30`.
- `/tiles/...` accept `safety`, `shallow`, `deep` (fallback to `sc` for compat).
- `GET /config/contours` returns server defaults.

## 7. CI & Validation
- Node validator flow; artifacts; tests.

## 8. Configuration & Running Locally
- Commands, Makefile snippets.

## 9. Coverage (auto-generated)
<!-- BEGIN:S52_COVERAGE -->
| metric | value |
| --- | ---: |
| total lookups | 231 |
| covered by style | 5 |
| missing | 226 |

### Missing OBJL
- ######
- $AREAS
- $CSYMB
- $LINES
- $TEXTS
- ACHARE
- ACHBRT
- ACHPNT
- ADMARE
- AIRARE
- ANNOTA
- ARCSLN
- ASLXIS
- BCNCAR
- BCNISD
- BCNLAT
- BCNSAW
- BCNSPP
- BCNWTW
- BERTHS

### Symbols seen
(none)
<!-- END:S52_COVERAGE -->

## 10. Known limits & roadmap
- Night/Dusk later; full pattern fills TBD; raster parity optional.
